{% extends 'layouts/general-layout.html' %}
{% load static %}
{% load widget_tweaks %}
{% block title %}Editar Perfil - Blog de Mascotas{% endblock title %}

{% block banner %}
<section class="relative w-full h-[320px] md:h-[420px] lg:h-[500px] overflow-hidden">
  <!-- Imagen -->
  <img 
    src="{% static 'img/banner6.webp' %}" 
    alt="Banner principal del sitio"
    fetchpriority="high"
    loading="eager"
    class="w-full h-full object-cover mt-3"
  >
  <!-- Contenido centrado -->
  <div class="absolute inset-0 flex items-center justify-center bg-black/40">
    <div class="text-center px-4">
      <h1 class="text-white text-4xl md:text-6xl font-extrabold tracking-wide drop-shadow-xl mb-4">
        Edita tu Perfil
      </h1>
      <p class="text-white text-base sm:text-lg md:text-xl font-medium max-w-2xl mx-auto drop-shadow-lg px-2">
        Personaliza tu informaci√≥n y presencia en la comunidad
      </p>
    </div>
  </div>
</section>
{% endblock banner %}

{% block content %}
<div class="max-w-6xl mx-auto px-4 py-8">
  
  <!-- Progreso de edici√≥n -->
  <div class="mb-10">
    
      <h2 class="text-2xl font-bold text-gray-800">Completa tu perfil</h2>
  </div>

  <div class="grid lg:grid-cols-3 gap-8">
    <!-- Columna izquierda - Vista previa -->
    <div class="lg:col-span-1">
      <div class="sticky top-8 space-y-6">
        <!-- Vista previa del perfil -->
        <div class="bg-white rounded-3xl shadow-xl border border-gray-200 overflow-hidden transition-all duration-300 hover:shadow-2xl">
          <div class="bg-gradient-to-r from-orange-500 to-amber-500 p-6 text-center">
            <div class="relative inline-block mb-4">
              <div class="w-32 h-32 rounded-full bg-gradient-to-br from-white/20 to-white/10 border-4 border-white shadow-2xl flex items-center justify-center mx-auto backdrop-blur-sm">
                <!-- INICIAL DEL USUARIO -->
                <span class="text-white text-5xl font-black">
                  {% if user.first_name %}
                    {{ user.first_name|first|upper }}
                  {% else %}
                    {{ user.username|first|upper }}
                  {% endif %}
                </span>
              </div>
              {% comment %} <div class="absolute bottom-4 right-4 w-6 h-6 bg-green-500 rounded-full border-2 border-white shadow-md"></div> {% endcomment %}
            </div>
            <h3 id="profile-preview-name" class="text-xl font-bold text-white mb-1">
              {% if user.first_name or user.last_name %}
                {{ user.first_name }} {{ user.last_name }}
              {% else %}
                {{ user.username }}
              {% endif %}
            </h3>
            <p class="text-white/90" id="profile-preview-username">@{{ user.username }}</p>
          </div>
          <div class="p-6">
            <div class="space-y-4">
              <div>
                <p class="text-sm font-semibold text-gray-500 mb-1">Correo electr√≥nico</p>
                <p class="text-gray-800 font-medium truncate" id="profile-preview-email">{{ user.email|default:"No especificado" }}</p>
              </div>
              <div>
                <p class="text-sm font-semibold text-gray-500 mb-1">Biograf√≠a</p>
                <p class="text-gray-600 text-sm line-clamp-3" id="profile-preview-bio">
                  {{ user.biografia|default:"¬°Cu√©ntanos sobre ti y tus mascotas!" }}
                </p>
              </div>
              {% if user.telefono %}
              <div>
                <p class="text-sm font-semibold text-gray-500 mb-1">Tel√©fono</p>
                <p class="text-gray-800 font-medium" id="profile-preview-phone">{{ user.telefono }}</p>
              </div>
              {% endif %}
            </div>
            <!-- Informaci√≥n sobre la inicial -->
            <div class="mt-6 pt-6 border-t border-gray-200">
              <p class="text-xs text-gray-500 flex items-center gap-2">
                <span class="text-orange-600">üë§</span>
                Tu avatar muestra la inicial de tu nombre. Para cambiarlo, actualiza tu nombre o apellido.
              </p>
            </div>
          </div>
        </div>

        <!-- Consejos para el perfil -->
        <div class="bg-gradient-to-br from-blue-50 to-indigo-50 rounded-2xl p-6 border border-blue-200">
          <h3 class="text-lg font-bold text-gray-800 mb-4 flex items-center gap-2">
            <svg class="w-5 h-5 text-blue-600" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"/>
            </svg>
            Consejos para tu perfil
          </h3>
          <ul class="space-y-3 text-sm text-gray-600">
            <li class="flex items-start gap-2">
              <span class="text-green-600 mt-0.5">‚úì</span>
              <span>Completa tu nombre para que te reconozcan en la comunidad</span>
            </li>
            <li class="flex items-start gap-2">
              <span class="text-green-600 mt-0.5">‚úì</span>
              <span>Comparte tus experiencias con mascotas en la biograf√≠a</span>
            </li>
            <li class="flex items-start gap-2">
              <span class="text-green-600 mt-0.5">‚úì</span>
              <span>Mant√©n tu informaci√≥n actualizada</span>
            </li>
            <li class="flex items-start gap-2">
              <span class="text-green-600 mt-0.5">‚úì</span>
              <span>Usa un correo electr√≥nico que revises frecuentemente</span>
            </li>
          </ul>
        </div>
      </div>
    </div>

    <!-- Columna derecha - Formulario -->
    <div class="lg:col-span-2">
      <!-- Formulario principal -->
      <div class="bg-white rounded-3xl shadow-2xl border border-orange-100 overflow-hidden transition-all duration-300 hover:shadow-3xl">

        <!-- Header del formulario -->
        <div class="bg-gradient-to-r from-orange-500 to-amber-500 p-8 relative overflow-hidden">
          <div class="absolute inset-0 opacity-10">
            <div class="absolute top-1/4 left-1/4 w-64 h-64 bg-white rounded-full"></div>
            <div class="absolute bottom-1/4 right-1/4 w-48 h-48 bg-white rounded-full"></div>
          </div>
          <div class="relative z-10">
            <h2 class="text-3xl font-bold text-white mb-2">Informaci√≥n Personal</h2>
            <p class="text-white/90">Actualiza los datos que quieras modificar</p>
          </div>
        </div>

        <!-- Mensajes de Django -->
        {% if messages %}
        <div class="px-8 pt-6">
          {% for message in messages %}
          <div class="animate-fade-in-down flex items-start gap-4 p-4 mb-4 rounded-xl 
            {% if message.tags == 'success' %} bg-gradient-to-r from-green-50 to-emerald-50 border border-green-200 text-green-800
            {% elif message.tags == 'error' %} bg-gradient-to-r from-red-50 to-rose-50 border border-red-200 text-red-800
            {% elif message.tags == 'warning' %} bg-gradient-to-r from-amber-50 to-yellow-50 border border-amber-200 text-amber-800
            {% else %} bg-gradient-to-r from-blue-50 to-sky-50 border border-blue-200 text-blue-800 {% endif %}">
            <div class="text-2xl flex-shrink-0">
              {% if message.tags == 'success' %} ‚úÖ
              {% elif message.tags == 'error' %} ‚ùå
              {% elif message.tags == 'warning' %} ‚ö†Ô∏è
              {% else %} ‚ÑπÔ∏è {% endif %}
            </div>
            <div class="flex-1">
              <p class="font-medium">{{ message }}</p>
              {% if message.tags == 'success' %}
              <div class="flex items-center gap-2 mt-2">
                <a href="{% url 'usuarios:perfil' %}" class="inline-flex items-center gap-2 px-4 py-2 bg-green-600 hover:bg-green-700 text-white font-medium rounded-lg transition-colors duration-200">
                  <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"/>
                  </svg>
                  Volver al perfil
                </a>
              </div>
              {% endif %}
            </div>
          </div>
          {% endfor %}
        </div>
        {% endif %}

        <form method="post" enctype="multipart/form-data" novalidate class="p-8 space-y-8" id="profile-form">
          {% csrf_token %}

          <!-- Errores generales -->
          {% if form.non_field_errors %}
          <div class="bg-gradient-to-r from-red-50 to-rose-50 border-l-4 border-red-500 p-4 rounded-lg animate-shake">
            <div class="flex items-start">
              <div class="text-red-500 text-xl mr-3">‚ö†Ô∏è</div>
              <div>
                <h4 class="font-bold text-red-700">Error en el formulario</h4>
                {% for error in form.non_field_errors %}
                <p class="text-red-600 text-sm mt-1">{{ error }}</p>
                {% endfor %}
              </div>
            </div>
          </div>
          {% endif %}

          <!-- Secci√≥n 1: Informaci√≥n b√°sica -->
          <div class="space-y-6">
            <div class="flex items-center gap-3 mb-4">
              <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-orange-500 to-amber-500 flex items-center justify-center">
                <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd"/>
                </svg>
              </div>
              <h3 class="text-xl font-bold text-gray-800">Informaci√≥n B√°sica</h3>
            </div>

            <div class="grid md:grid-cols-2 gap-6">
              <!-- Nombre -->
              <div class="space-y-2">
                <label class="block text-sm font-bold text-orange-700">
                  Nombre
                  <span class="text-red-500">*</span>
                </label>
                <div class="relative group">
                  {{ form.first_name|add_class:"w-full px-4 py-3 bg-white border border-orange-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-orange-400 focus:border-transparent transition group-hover:border-orange-400"|attr:"placeholder=Tu nombre" }}
                  <div class="absolute right-3 top-3 text-gray-400">
                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                      <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd"/>
                    </svg>
                  </div>
                </div>
                <p class="text-xs text-gray-500 mt-1 flex items-center gap-1">
                  <span>üë§</span> Esta inicial aparecer√° como tu avatar
                </p>
                {% if form.first_name.errors %}
                <div class="text-red-600 text-sm mt-1 flex items-center gap-1">
                  <span>‚ö†Ô∏è</span> {{ form.first_name.errors|striptags }}
                </div>
                {% endif %}
              </div>

              <!-- Apellido -->
              <div class="space-y-2">
                <label class="block text-sm font-bold text-orange-700">
                  Apellido
                </label>
                {{ form.last_name|add_class:"w-full px-4 py-3 bg-white border border-orange-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-orange-400 focus:border-transparent transition hover:border-orange-400"|attr:"placeholder=Tu apellido" }}
                {% if form.last_name.errors %}
                <div class="text-red-600 text-sm mt-1 flex items-center gap-1">
                  <span>‚ö†Ô∏è</span> {{ form.last_name.errors|striptags }}
                </div>
                {% endif %}
              </div>

              <!-- Email -->
              <div class="space-y-2">
                <label class="block text-sm font-bold text-orange-700">
                  Correo electr√≥nico
                  <span class="text-red-500">*</span>
                </label>
                <div class="relative group">
                  {{ form.email|add_class:"w-full px-4 py-3 bg-white border border-orange-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-orange-400 focus:border-transparent transition group-hover:border-orange-400"|attr:"placeholder=correo@ejemplo.com" }}
                  <div class="absolute right-3 top-3 text-gray-400">
                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                      <path d="M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z"/>
                      <path d="M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z"/>
                    </svg>
                  </div>
                </div>
                <p class="text-xs text-gray-500 mt-1 flex items-center gap-1">
                  <span>üìß</span> Usaremos este email para notificaciones importantes.
                </p>
                {% if form.email.errors %}
                <div class="text-red-600 text-sm mt-1 flex items-center gap-1">
                  <span>‚ö†Ô∏è</span> {{ form.email.errors|striptags }}
                </div>
                {% endif %}
              </div>

              <!-- Tel√©fono -->
              <div class="space-y-2">
                <label class="block text-sm font-bold text-orange-700">
                  Tel√©fono
                </label>
                <div class="relative group">
                  {{ form.telefono|add_class:"w-full px-4 py-3 bg-white border border-orange-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-orange-400 focus:border-transparent transition group-hover:border-orange-400"|attr:"placeholder=+1234567890" }}
                  <div class="absolute right-3 top-3 text-gray-400">
                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                      <path d="M2 3a1 1 0 011-1h2.153a1 1 0 01.986.836l.74 4.435a1 1 0 01-.54 1.06l-1.548.773a11.037 11.037 0 006.105 6.105l.774-1.548a1 1 0 011.059-.54l4.435.74a1 1 0 01.836.986V17a1 1 0 01-1 1h-2C7.82 18 2 12.18 2 5V3z"/>
                    </svg>
                  </div>
                </div>
                <p class="text-xs text-gray-500 mt-1 flex items-center gap-1">
                  <span>üìû</span> Opcional - Solo para contacto interno
                </p>
                {% if form.telefono.errors %}
                <div class="text-red-600 text-sm mt-1 flex items-center gap-1">
                  <span>‚ö†Ô∏è</span> {{ form.telefono.errors|striptags }}
                </div>
                {% endif %}
              </div>
            </div>

            <!-- Informaci√≥n sobre la inicial -->
            <div class="p-4 bg-gradient-to-br from-orange-50 to-amber-50 rounded-xl border border-orange-200">
              <div class="flex items-start gap-3">
                <div class="flex-shrink-0 w-10 h-10 rounded-lg bg-gradient-to-br from-orange-500 to-amber-500 flex items-center justify-center">
                  <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd"/>
                  </svg>
                </div>
                <div>
                  <p class="text-sm font-semibold text-gray-800 mb-1">Tu avatar</p>
                  <p class="text-xs text-gray-600">
                    Tu perfil mostrar√° la inicial de tu nombre como avatar. Para cambiar la letra, 
                    actualiza tu nombre o apellido arriba. La inicial se actualizar√° autom√°ticamente.
                  </p>
                </div>
              </div>
            </div>
          </div>
{% comment %} 
          <!-- Secci√≥n 2: Biograf√≠a -->
          <div class="space-y-6 pt-8 border-t border-orange-200">
            <div class="flex items-center gap-3 mb-4">
              <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-orange-500 to-amber-500 flex items-center justify-center">
                <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M18 13V5a2 2 0 00-2-2H4a2 2 0 00-2 2v8a2 2 0 002 2h3l3 3 3-3h3a2 2 0 002-2zM5 7a1 1 0 011-1h8a1 1 0 110 2H6a1 1 0 01-1-1zm1 3a1 1 0 100 2h3a1 1 0 100-2H6z" clip-rule="evenodd"/>
                </svg>
              </div>
              <h3 class="text-xl font-bold text-gray-800">Biograf√≠a</h3>
            </div>

            <div class="space-y-2">
              <label class="block text-sm font-bold text-orange-700">
                Sobre ti
                <span class="text-gray-500 font-normal">(Opcional)</span>
              </label>
              <div class="relative group">
                {{ form.biografia|add_class:"w-full px-4 py-3 bg-white border border-orange-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-orange-400 focus:border-transparent transition group-hover:border-orange-400 resize-none"|attr:"rows=6"|attr:"placeholder=Cu√©ntanos sobre ti, tus mascotas, experiencias, consejos..." }}
                <div class="absolute bottom-3 right-3">
                  <div class="flex items-center gap-2">
                    <span id="bio-counter" class="text-sm font-medium text-orange-600">0/500</span>
                    <span class="text-gray-400">caracteres</span>
                  </div>
                </div>
              </div>
              <div class="text-xs text-gray-500 space-y-1">
                <p class="flex items-center gap-2">
                  <span>üí°</span> 
                  Comparte tu experiencia con mascotas, consejos √∫tiles o historias interesantes
                </p>
                <p class="flex items-center gap-2">
                  <span>‚ú®</span>
                  Una buena biograf√≠a ayuda a conectar con otros miembros de la comunidad
                </p>
              </div>
              {% if form.biografia.errors %}
              <div class="text-red-600 text-sm mt-1 flex items-center gap-1">
                <span>‚ö†Ô∏è</span> {{ form.biografia.errors|striptags }}
              </div>
              {% endif %}
            </div>
          </div> {% endcomment %}

          <!-- Botones de acci√≥n -->
          <div class="flex flex-wrap gap-4 justify-between items-center pt-8 border-t border-orange-200">
            <div class="flex flex-wrap gap-3">
              <a href="{% url 'usuarios:perfil' %}" 
                 class="group flex items-center gap-2 px-6 py-3 bg-gradient-to-r from-gray-100 to-gray-200 hover:from-gray-200 hover:to-gray-300 text-gray-800 font-bold rounded-xl shadow-md hover:shadow-lg transition-all duration-300 hover:-translate-y-0.5">
                <svg class="w-5 h-5 group-hover:-translate-x-1 transition-transform" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"/>
                </svg>
                Cancelar
              </a>
            </div>

            <div class="flex flex-wrap gap-3">
              <button type="reset" 
                      class="group flex items-center gap-2 px-6 py-3 bg-gradient-to-r from-gray-500 to-gray-600 hover:from-gray-600 hover:to-gray-700 text-white font-bold rounded-xl shadow-md hover:shadow-lg transition-all duration-300 hover:-translate-y-0.5">
                <svg class="w-5 h-5 group-hover:rotate-180 transition-transform" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z" clip-rule="evenodd"/>
                </svg>
                Restablecer
              </button>
              <button type="submit" 
                      class="group flex items-center gap-2 px-8 py-3.5 bg-gradient-to-r from-orange-600 to-amber-600 hover:from-orange-700 hover:to-amber-700 text-white font-bold rounded-xl shadow-lg hover:shadow-xl transition-all duration-300 hover:-translate-y-0.5 relative overflow-hidden">
                <div class="absolute inset-0 bg-gradient-to-r from-white/0 via-white/20 to-white/0 translate-x-[-100%] group-hover:translate-x-[100%] transition-transform duration-700"></div>
                <svg class="w-5 h-5 relative z-10 group-hover:scale-110 transition-transform" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
                </svg>
                <span class="relative z-10">Guardar cambios</span>
              </button>
            </div>
          </div>
        </form>
      </div>

      <!-- Zona de peligro -->
      <div class="mt-8 bg-gradient-to-r from-red-50 to-rose-50 rounded-2xl border border-red-200 p-8 overflow-hidden">
        <div class="absolute top-0 left-0 w-24 h-24 bg-red-500/10 rounded-full -translate-x-12 -translate-y-12"></div>
        <div class="absolute bottom-0 right-0 w-32 h-32 bg-red-500/10 rounded-full translate-x-16 translate-y-16"></div>
        
        <div class="relative z-10">
          <div class="flex flex-col md:flex-row md:items-start justify-between gap-6">
            <div class="flex items-start gap-4">
              <div class="flex-shrink-0 w-14 h-14 bg-gradient-to-br from-red-500 to-rose-500 rounded-xl flex items-center justify-center shadow-lg">
                <svg class="w-7 h-7 text-white" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd"/>
                </svg>
              </div>
              <div>
                <h3 class="text-xl font-bold text-red-700 mb-2">Zona de peligro</h3>
                <div class="space-y-2 text-red-600/80">
                  <p class="flex items-start gap-2">
                    <span>‚ö†Ô∏è</span>
                    <span>Esta acci√≥n eliminar√° permanentemente tu cuenta y todos tus datos.</span>
                  </p>
                  <p class="flex items-start gap-2">
                    <span>üóëÔ∏è</span>
                    <span>Tus art√≠culos, comentarios y perfiles de mascotas ser√°n eliminados.</span>
                  </p>
                  <p class="flex items-start gap-2 text-red-500/60">
                    <span>‚ùå</span>
                    <span>Esta acci√≥n no se puede deshacer.</span>
                  </p>
                </div>
              </div>
            </div>
            <div class="flex flex-col gap-3">
              <a href="{% url 'usuarios:eliminar_cuenta' %}" 
                 class="group flex items-center justify-center gap-2 px-8 py-3.5 bg-gradient-to-r from-red-500 to-rose-500 hover:from-red-600 hover:to-rose-600 text-white font-bold rounded-xl shadow-md hover:shadow-lg transition-all duration-300 hover:-translate-y-0.5">
                <svg class="w-5 h-5 group-hover:scale-110 transition-transform" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd"/>
                </svg>
                Eliminar cuenta
              </a>
              <p class="text-xs text-red-500/60 text-center">
                Pensalo dos veces antes de continuar
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Scripts -->
<script>
document.addEventListener('DOMContentLoaded', function() {
  // Configurar ancho de la barra de progreso
  const progressBar = document.querySelector('.progress-bar');
  if (progressBar) {
    const filled = parseInt(progressBar.dataset.filled) || 0;
    const total = parseInt(progressBar.dataset.total) || 1;
    const percentage = Math.round((filled / total) * 100);
    progressBar.style.width = percentage + '%';
  }

  // Contador de caracteres para biograf√≠a
  const bioTextarea = document.querySelector('textarea[name="biografia"]');
  const bioCounter = document.getElementById('bio-counter');
  
  if (bioTextarea && bioCounter) {
    function updateBioCounter() {
      const length = bioTextarea.value.length;
      const maxLength = 500;
      bioCounter.textContent = `${length}/${maxLength}`;
      
      // Actualizar vista previa del perfil
      const bioPreview = document.getElementById('profile-preview-bio');
      if (bioPreview) {
        bioPreview.textContent = bioTextarea.value || '¬°Cu√©ntanos sobre ti y tus mascotas!';
      }
      
      // Cambiar color seg√∫n el porcentaje
      const percentage = (length / maxLength) * 100;
      if (percentage > 90) {
        bioCounter.className = 'text-sm font-medium text-red-600';
      } else if (percentage > 75) {
        bioCounter.className = 'text-sm font-medium text-amber-600';
      } else {
        bioCounter.className = 'text-sm font-medium text-orange-600';
      }
    }
    
    bioTextarea.addEventListener('input', updateBioCounter);
    updateBioCounter(); // Inicializar
  }

  // Actualizaci√≥n en tiempo real de la vista previa del perfil
  const nameInput = document.querySelector('input[name="first_name"]');
  const lastNameInput = document.querySelector('input[name="last_name"]');
  const emailInput = document.querySelector('input[name="email"]');
  const phoneInput = document.querySelector('input[name="telefono"]');

  // Funci√≥n para actualizar la inicial en la vista previa
  function updateInitialPreview() {
    const firstName = nameInput ? nameInput.value.trim() : "{{ user.first_name|default:'' }}";
    const previewAvatar = document.querySelector('.bg-gradient-to-br.from-white\\/20 .text-white');
    
    if (previewAvatar) {
      const initial = firstName ? firstName.charAt(0).toUpperCase() : "{{ user.username|first|upper }}";
      previewAvatar.textContent = initial;
    }
  }

  if (nameInput) {
    nameInput.addEventListener('input', function() {
      // Actualizar nombre en vista previa
      const previewName = document.getElementById('profile-preview-name');
      const lastName = lastNameInput ? lastNameInput.value.trim() : '';
      const fullName = this.value.trim() || "{{ user.username }}";
      if (lastName) {
        previewName.textContent = this.value.trim() + ' ' + lastName;
      } else {
        previewName.textContent = this.value.trim() || "{{ user.username }}";
      }
      
      // Actualizar inicial
      updateInitialPreview();
    });
  }

  if (lastNameInput) {
    lastNameInput.addEventListener('input', function() {
      const previewName = document.getElementById('profile-preview-name');
      const firstName = nameInput ? nameInput.value.trim() : '';
      const fullName = firstName || "{{ user.username }}";
      if (this.value.trim()) {
        previewName.textContent = firstName + ' ' + this.value.trim();
      } else {
        previewName.textContent = firstName || "{{ user.username }}";
      }
    });
  }

  if (emailInput) {
    emailInput.addEventListener('input', function() {
      const previewEmail = document.getElementById('profile-preview-email');
      previewEmail.textContent = this.value || 'No especificado';
    });
  }

  if (phoneInput) {
    phoneInput.addEventListener('input', function() {
      const previewPhone = document.getElementById('profile-preview-phone');
      previewPhone.textContent = this.value || 'No especificado';
    });
  }

  // Inicializar vista previa de la inicial
  updateInitialPreview();

  // Efecto de shake para errores
  const errorElements = document.querySelectorAll('.animate-shake');
  errorElements.forEach(el => {
    setTimeout(() => {
      el.classList.remove('animate-shake');
    }, 1000);
  });

  // Validaci√≥n en tiempo real del formulario
  const form = document.getElementById('profile-form');
  if (form) {
    const inputs = form.querySelectorAll('input[required], textarea[required]');
    
    inputs.forEach(input => {
      input.addEventListener('blur', function() {
        if (!this.value.trim()) {
          this.classList.add('border-red-500', 'bg-red-50');
          this.classList.remove('border-orange-300');
        } else {
          this.classList.remove('border-red-500', 'bg-red-50');
          this.classList.add('border-orange-300');
        }
      });
    });
  }
});

// Funci√≥n para formatear tel√©fono
function formatPhoneNumber(input) {
  let value = input.value.replace(/\D/g, '');
  if (value.length > 0) {
    value = '+' + value;
    if (value.length > 4) {
      value = value.substring(0, 4) + ' ' + value.substring(4);
    }
    if (value.length > 9) {
      value = value.substring(0, 9) + ' ' + value.substring(9);
    }
  }
  input.value = value;
}
</script>

{% endblock content %}