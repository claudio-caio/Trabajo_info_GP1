{% extends 'layouts/general-layout.html' %}
{% load static %}

{% block title %}{{ articulo.titulo }}{% endblock title %}

{% block banner %}
<section class="relative w-full h-[300px] md:h-[420px] lg:h-[500px] overflow-hidden">

  <!-- Imagen -->
  <img 
    src="{% static 'img/banner_articulo.jpg' %}" 
    alt="Banner del art√≠culo"
    class="w-full h-full object-cover"
  >

  <!-- T√≠tulo centrado -->
  <div class="absolute inset-0 flex items-center justify-center bg-black/40">
    <h1 class="text-white text-4xl md:text-6xl font-extrabold tracking-wide drop-shadow-xl">
      Mundo Mascotas
    </h1>
  </div>

</section>
{% endblock banner %}

{% block content %}
<div class="max-w-4xl mx-auto px-4 py-10">

  <!-- T√≠tulo -->
  <h1 class="text-4xl font-bold text-center text-orange-700 mb-4">
    {{ articulo.titulo }}
  </h1>

  <!-- Contenido -->
  <div class="prose prose-lg max-w-none my-10 text-gray-800 leading-relaxed">
    {{ articulo.contenido|linebreaksbr|urlize|safe }}
  </div>

  <!-- Galer√≠a -->
  {% if articulo.imagenes.all %}
  <h3 class="text-2xl font-semibold text-orange-700 mb-3">Galer√≠a</h3>

  <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 my-6">
    {% for imagen in articulo.imagenes.all %}
      <button 
        onclick="openModal('modalImagen{{ forloop.counter }}')"
        class="group relative"
      >
        <img 
          src="{{ imagen.imagen.url }}" 
          alt="{{ articulo.titulo }}"
          class="rounded-xl w-full h-56 object-cover shadow-md group-hover:shadow-2xl transition"
        >
      </button>

      <!-- Modal -->
      <div 
        id="modalImagen{{ forloop.counter }}" 
        class="fixed inset-0 bg-black/70 backdrop-blur-sm items-center justify-center z-50 hidden"
        style="display: none;"
      >
        <div class="relative max-w-4xl mx-auto p-4">
          <img src="{{ imagen.imagen.url }}" class="rounded-xl w-full h-auto shadow-xl">
          <button 
            onclick="closeModal('modalImagen{{ forloop.counter }}')" 
            class="absolute top-3 right-3 bg-white rounded-full px-3 py-1 text-black font-bold shadow"
          >
            ‚úï
          </button>
        </div>
      </div>

    {% endfor %}
  </div>
  {% endif %}

  <!-- Visitas -->
  <span class="inline-block bg-orange-200 text-orange-800 px-3 py-1 rounded-full text-sm font-semibold mb-5">
    {{ articulo.visitas }} visitas
  </span>

  <!-- Botones de edici√≥n -->
  {% if usuario_actual.is_authenticated and usuario_actual == articulo.autor or usuario_actual.is_staff or usuario_actual.is_superuser %}
  <div class="flex flex-wrap gap-3 my-5">
    <a href="{% url 'posts:articulo_editar' articulo.pk %}"
       class="px-4 py-2 bg-yellow-500 hover:bg-yellow-600 text-white rounded-lg shadow-md transition">
       ‚úè Editar
    </a>

    <a href="{% url 'posts:articulo_eliminar' articulo.pk %}"
       class="px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg shadow-md transition">
       üóë Eliminar
    </a>
  </div>
  {% endif %}

  <hr class="my-8 border-gray-300">

  <!-- Comentarios -->
  <h3 class="text-2xl font-semibold text-orange-700 mb-4">Comentarios</h3>

  <div class="space-y-4">
    {% for comentario in comentarios %}
      <div class="border border-orange-200 rounded-xl p-4 shadow-sm bg-orange-50">
        <strong class="text-orange-800">{{ comentario.autor }}</strong>
        <p class="mt-1 text-gray-700">{{ comentario.contenido }}</p>

        {% if usuario_actual == comentario.autor or usuario_actual.is_superuser or usuario_actual.is_staff %}
        <div class="flex gap-3 mt-2">
          <a href="{% url 'comentarios:editar_comentario' comentario.pk %}"
             class="text-yellow-700 hover:text-yellow-800 text-sm font-medium">
             Editar
          </a>

          <a href="{% url 'comentarios:eliminar_comentario' comentario.pk %}"
             class="text-red-600 hover:text-red-700 text-sm font-medium">
             Eliminar
          </a>
        </div>
        {% endif %}
      </div>
    {% empty %}
      <p class="text-gray-600">No hay comentarios a√∫n. ¬°S√© el primero en comentar!</p>
    {% endfor %}
  </div>

  <!-- Formulario -->
  {% if usuario_actual.is_authenticated %}
  <hr class="my-8">
  <h4 class="text-xl font-semibold text-orange-700 mb-3">Deja tu comentario</h4>

  <form action="{% url 'comentarios:crear_comentario' articulo.pk %}" method="post" class="space-y-3">
    {% csrf_token %}
    {{ form.contenido }}

    <button 
      type="submit" 
      class="px-5 py-2 bg-orange-600 hover:bg-orange-700 text-white rounded-lg shadow-md transition"
    >
      Comentar
    </button>
  </form>
  {% else %}
    <p class="text-gray-700 mt-4">
      Debes 
      <a href="{% url 'usuarios:login' %}" class="text-orange-700 underline">iniciar sesi√≥n</a> 
      para comentar.
    </p>
  {% endif %}

  <!-- Volver -->
  <div class="mt-10 text-center">
    <a href="{% url 'posts:articulo_lista' %}"
       class="px-4 py-2 bg-gray-200 hover:bg-gray-300 text-gray-800 rounded-lg shadow">
      ‚Üê Volver a posts
    </a>
  </div>

</div>

<!-- Scripts -->
<script>
function openModal(id) {
  document.getElementById(id).classList.remove("hidden");
}
function closeModal(id) {
  document.getElementById(id).classList.add("hidden");
}
</script>

<script>
document.addEventListener("DOMContentLoaded", () => {
  document.querySelectorAll('.prose a').forEach(a => {
      a.setAttribute('target', '_blank');
      a.setAttribute('rel', 'noopener noreferrer');
  });
});
</script>

{% endblock content %}

