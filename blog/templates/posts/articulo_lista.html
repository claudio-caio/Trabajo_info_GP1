{% extends 'layouts/general-layout.html' %}
{% load static %}

{% block title %}Posts{% endblock title %}

{% block banner %}
<section class="relative w-full h-[320px] md:h-[420px] lg:h-[500px] overflow-hidden ">

  <!-- Imagen -->
  <img 
    src="{% static 'img/img5.png' %}" 
    alt="Banner principal del sitio"
    fetchpriority="high"
    loading="eager"
    class="w-full h-full object-cover mt-3"
  >

  <!-- Contenido centrado -->
  <div class="absolute inset-0 flex items-center justify-center">
    <h1 class="text-orange-600 text-3xl md:text-5xl font-extrabold tracking-wide drop-shadow-lg">
      Programa con Pasi√≥n
    </h1>
  </div>

</section>
{% endblock banner %}

{% block content %}
<div class="container">
<h1 class="text-3xl font-bold text-center text-amber-700 mb-6 flex items-center justify-center gap-2">
  üêæ Lista de Posts
</h1>

<!-- Filtros y Ordenamiento -->
<div class="bg-white shadow-md rounded-xl p-5 border border-amber-100 mb-8">

  <form method="get" class="grid grid-cols-1 md:grid-cols-2 gap-4">

    <!-- Selecci√≥n de categor√≠a -->
    <div>
      <label class="block text-sm text-gray-600 mb-1 font-semibold">
        Categor√≠a
      </label>
      <select 
        name="categoria" 
        onchange="this.form.submit()"
        class="w-full p-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-amber-400 focus:outline-none bg-amber-50"
      >
        <option value="">Todas las categor√≠as</option>
        {% for cat in categorias %}
          <option value="{{ cat.id }}" 
            {% if request.GET.categoria == cat.id|stringformat:"s" %}selected{% endif %}
          >
            {{ cat.nombre }}
          </option>
        {% endfor %}
      </select>
    </div>

    <!-- Ordenamiento -->
    <div>
      <label class="block text-sm text-gray-600 mb-1 font-semibold">
        Ordenar por
      </label>
      <select 
        name="ordenar_por" 
        onchange="this.form.submit()"
        class="w-full p-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-amber-400 focus:outline-none bg-amber-50"
      >
        <option value="">Seleccione una opci√≥n</option>
        <option value="mas_recientes" {% if request.GET.ordenar_por == 'mas_recientes' %}selected{% endif %}>
          M√°s recientes
        </option>
        <option value="mas_vistos" {% if request.GET.ordenar_por == 'mas_vistos' %}selected{% endif %}>
          M√°s vistos
        </option>
        <option value="fecha_ascendente" {% if request.GET.ordenar_por == 'fecha_ascendente' %}selected{% endif %}>
          Fecha ascendente
        </option>
        <option value="fecha_descendente" {% if request.GET.ordenar_por == 'fecha_descendente' %}selected{% endif %}>
          Fecha descendente
        </option>
      </select>
    </div>

  </form>

</div>

</form>

<div class="mt-6">
    {% if user.is_authenticated %}
        <a 
            href="{% url 'posts:articulo_crear' %}" 
            class="inline-block px-5 py-2 bg-green-500 hover:bg-green-600 text-white font-bold rounded-lg shadow transition"
        >
            Cargar posteo
        </a>
    {% else %}
        <a 
            href="{% url 'usuarios:login' %}?next={% url 'posts:articulo_crear' %}" 
            class="inline-block px-5 py-2 bg-green-500 hover:bg-green-600 text-white font-bold rounded-lg shadow transition"
        >
            Cargar posteo
        </a>
    {% endif %}
</div>



  <!-- Lista de art√≠culos -->
  <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mt-8">

  {% for articulo in articulos %}
    <div class="bg-white shadow-md rounded-xl p-4 hover:shadow-lg transition">

      {% if articulo.imagenes.all %}
        <img 
          src="{{ articulo.imagenes.all.0.imagen.url }}" 
          alt="{{ articulo.titulo }}" 
          class="w-full h-64 object-cover rounded-lg mb-4"
        >
      {% endif %}

      <h2 class="text-xl font-semibold mb-2">
        <a 
          href="{% url 'posts:articulo_detalle' articulo.pk %}" 
          class="hover:text-blue-600"
        >
          {{ articulo.titulo }}
        </a>
      </h2>

      <p class="text-sm text-gray-600 mb-3">
        Autor: {{ articulo.autor.username }} |
        {{ articulo.fecha_publicacion|date:"d/m/Y" }} |
        Vistas: {{ articulo.vistas }}
      </p>

      <p class="text-gray-700 mb-3">
        {{ articulo.descripcion|truncatewords:40 }}
      </p>

      <a 
        href="{% url 'posts:articulo_detalle' articulo.pk %}" 
        class="text-blue-600 hover:underline font-semibold"
      >
        Leer m√°s ‚Üí
      </a>

    </div>
  {% empty %}
    <p>No hay art√≠culos para mostrar.</p>
  {% endfor %}

</div>

 <!-- Paginaci√≥n -->
{% if is_paginated %}
<nav class="mt-6">
  <ul class="flex items-center justify-center space-x-2">

    {# Bot√≥n "Anterior" #}
    {% if page_obj.has_previous %}
      <li>
        <a href="?page={{ page_obj.previous_page_number }}"
           class="px-3 py-1 bg-white border border-gray-300 rounded-lg hover:bg-gray-100">
          Anterior
        </a>
      </li>
    {% else %}
      <li>
        <span class="px-3 py-1 bg-gray-200 text-gray-500 border border-gray-300 rounded-lg cursor-not-allowed">
          Anterior
        </span>
      </li>
    {% endif %}

    {# N√∫meros de p√°ginas #}
    {% for num in page_obj.paginator.page_range %}
      {% if num == page_obj.number %}
        <li>
          <span class="px-3 py-1 bg-orange-500 text-white border border-orange-600 rounded-lg font-semibold">
            {{ num }}
          </span>
        </li>
      {% else %}
        <li>
          <a href="?page={{ num }}"
             class="px-3 py-1 bg-white border border-gray-300 rounded-lg hover:bg-gray-100">
            {{ num }}
          </a>
        </li>
      {% endif %}
    {% endfor %}

    {# Bot√≥n "Siguiente" #}
    {% if page_obj.has_next %}
      <li>
        <a href="?page={{ page_obj.next_page_number }}"
           class="px-3 py-1 bg-white border border-gray-300 rounded-lg hover:bg-gray-100">
          Siguiente
        </a>
      </li>
    {% else %}
      <li>
        <span class="px-3 py-1 bg-gray-200 text-gray-500 border border-gray-300 rounded-lg cursor-not-allowed">
          Siguiente
        </span>
      </li>
    {% endif %}

  </ul>
</nav>
{% endif %}


  </div>

</div>

{% endblock content %}
